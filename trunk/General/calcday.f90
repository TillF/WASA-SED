! Till: computationally irrelevant: minor changes to improve compiler compatibility
! 2011-04-29

SUBROUTINE calcday

use time_h

INTEGER :: temp
! day in month given day in year (1=normal, 2=leap year)
INTEGER(kind=1) :: daynr(367,2)
! month given day in year (1=normal, 2=leap year)
INTEGER(kind=1) :: monnr(367,2)

DATA daynr / 1, 2, 3, 4, 5, 6, 7, 8, 9,10,11,12,13,14,15,16,  &
    17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,  &
    1, 2, 3, 4, 5, 6, 7, 8, 9,10,11,12,13,14,15,16,  &
    17,18,19,20,21,22,23,24,25,26,27,28,  &
    1, 2, 3, 4, 5, 6, 7, 8, 9,10,11,12,13,14,15,16,  &
    17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,  &
    1, 2, 3, 4, 5, 6, 7, 8, 9,10,11,12,13,14,15,16,  &
    17,18,19,20,21,22,23,24,25,26,27,28,29,30,  &
    1, 2, 3, 4, 5, 6, 7, 8, 9,10,11,12,13,14,15,16,  &
    17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,  &
    1, 2, 3, 4, 5, 6, 7, 8, 9,10,11,12,13,14,15,16,  &
    17,18,19,20,21,22,23,24,25,26,27,28,29,30,  &
    1, 2, 3, 4, 5, 6, 7, 8, 9,10,11,12,13,14,15,16,  &
    17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,  &
    1, 2, 3, 4, 5, 6, 7, 8, 9,10,11,12,13,14,15,16,  &
    17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,  &
    1, 2, 3, 4, 5, 6, 7, 8, 9,10,11,12,13,14,15,16,  &
    17,18,19,20,21,22,23,24,25,26,27,28,29,30,  &
    1, 2, 3, 4, 5, 6, 7, 8, 9,10,11,12,13,14,15,16,  &
    17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,  &
    1, 2, 3, 4, 5, 6, 7, 8, 9,10,11,12,13,14,15,16,  &
    17,18,19,20,21,22,23,24,25,26,27,28,29,30,  &
    1, 2, 3, 4, 5, 6, 7, 8, 9,10,11,12,13,14,15,16,  &
    17,18,19,20,21,22,23,24,25,26,27,28,29,30,31, 1, 1,  &
    1, 2, 3, 4, 5, 6, 7, 8, 9,10,11,12,13,14,15,16,  &
    17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,  &
    1, 2, 3, 4, 5, 6, 7, 8, 9,10,11,12,13,14,15,16,  &
    17,18,19,20,21,22,23,24,25,26,27,28,29,  &
    1, 2, 3, 4, 5, 6, 7, 8, 9,10,11,12,13,14,15,16,  &
    17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,  &
    1, 2, 3, 4, 5, 6, 7, 8, 9,10,11,12,13,14,15,16,  &
    17,18,19,20,21,22,23,24,25,26,27,28,29,30,  &
    1, 2, 3, 4, 5, 6, 7, 8, 9,10,11,12,13,14,15,16,  &
    17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,  &
    1, 2, 3, 4, 5, 6, 7, 8, 9,10,11,12,13,14,15,16,  &
    17,18,19,20,21,22,23,24,25,26,27,28,29,30,  &
    1, 2, 3, 4, 5, 6, 7, 8, 9,10,11,12,13,14,15,16,  &
    17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,  &
    1, 2, 3, 4, 5, 6, 7, 8, 9,10,11,12,13,14,15,16,  &
    17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,  &
    1, 2, 3, 4, 5, 6, 7, 8, 9,10,11,12,13,14,15,16,  &
    17,18,19,20,21,22,23,24,25,26,27,28,29,30,  &
    1, 2, 3, 4, 5, 6, 7, 8, 9,10,11,12,13,14,15,16,  &
    17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,  &
    1, 2, 3, 4, 5, 6, 7, 8, 9,10,11,12,13,14,15,16,  &
    17,18,19,20,21,22,23,24,25,26,27,28,29,30,  &
    1, 2, 3, 4, 5, 6, 7, 8, 9,10,11,12,13,14,15,16,  &
    17,18,19,20,21,22,23,24,25,26,27,28,29,30,31, 1/
DATA monnr /31* 1,28* 2,31* 3,30* 4,31* 5,30* 6,  &
    31* 7,31* 8,30* 9,31*10,30*11,31*12,2* 1,  &
    31* 1,29* 2,31* 3,30* 4,31* 5,30* 6, 31* 7,31* 8,30* 9,31*10,30*11,31*12,1* 1/


IF (MOD(t,4) == 0) THEN
  daymon(2) =  29
  temp=2
ELSE
  daymon(2) =  28
  temp=1
END IF

idold = d
IF (t == tstart) THEN
  idmon = daynr(d+sum(daymon(1:mstart-1)),temp)
  m     = monnr(d+sum(daymon(1:mstart-1)),temp)
  mnew  = monnr(d+1+sum(daymon(1:mstart-1)),temp)
ELSE
  idmon = daynr(d,temp)
  m     = monnr(d,temp)
  mnew  = monnr(d,temp)
END IF

RETURN
END SUBROUTINE calcday
