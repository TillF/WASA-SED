DO h=1,nbrhori(soilid)
                        lath=min(size(remainlat),INT(sum(horiz_thickness(tcid_instance2,i,1:h))/500.))	!Till: compute number of "exchange horizons" to be used from remainlat to be fed into the current profile
                        IF (lath > 0) THEN
                            temp2=sum(remainlat(1:lath))			!Till: max amount of water that is available to be routed into this horizon [mm]
                                                                    !ii: wouldn't remainlat(lath-1:lath) suffice, as the higher horizons are zeroed anyway some line below? better simply use an extra var "excessfromhigherhorizons" or add the excess to remainlat(lath+1)
                            !  update soil moisture of this horizon
                            !  maximum inflow may be limited by hydraulic conductivity
                            IF (temp2 > 0.) THEN
                                !Till: compute maximum inflow according to "exchange surface"
                                !Andreas: has to be in unit mm, correct calculation similar to lateral outflow calculation
                                temp3=k_sat(soilid,h)/dt_per_day*(1.-coarse(soilid,h))* &           ! Q_li
                                horiz_thickness(tcid_instance2,i,h)*slope(id_tc_type2)/100.  &
                                    /  slength(i_lu) / fracterrain(id_tc_type2)/1000.

                                temp3=MIN(temp3,temp2)					!Till: actual amount of water going into current horizon
                                horithact(tcid_instance2,i,h)=horithact(tcid_instance2,i,h)+temp3 !mm

                                remainlat(1:lath)=0.
                                IF (temp3 < temp2) THEN					!Till: if inflow is limited by conductivity, the rest is stored for further redistribution
                                    remainlat(lath)=temp2-temp3
                                END IF
                                !  if horizon is saturated, remaining lateral inflow may be added to
                                !  lower horizon
                                temp5=horithact(tcid_instance2,i,h) - thetas(soilid,h)* horiz_thickness(tcid_instance2,i,h)	!Till: compute if watercontent exceeds saturation

                                IF (temp5 > 0. ) THEN	!Till: if water content exceeds saturation...
                                    remainlat(lath)=remainlat(lath)+ temp5				!Till: excess cannot flow into this horizon
                                    horithact(tcid_instance2,i,h)=thetas(soilid,h)* horiz_thickness(tcid_instance2,i,h)	!Till: horizon is saturated
                                END IF
                            END IF
                        END IF
                        ! enddo for all horizons